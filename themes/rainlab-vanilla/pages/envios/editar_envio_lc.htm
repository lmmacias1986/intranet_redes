title = "editar_envio_lc"
url = "/editar_envio_lc/:id?"
layout = "formularios"
description = "editar envios locales"
is_hidden = 0
==
<?php
function onStart(){
	$local = Db::table('envios_locales')->where('id','=', $this->param('id'))->first();
	$this['local'] = $local;
	$this['eliminar'] = "OK";
}
function onRedirect(){
	return Redirect::to('locales');
}
function onDelete(){
    Db::table('envios_locales')->where('id', '=', $this->param('id'))->delete();
    $this['mensaje_lc'] = "Envío eliminado correctamente";
}
function onUpdate(){
	$validator = false;
    if(input('fecha_envio_lc')==""){   
        $this['error'] = "Debe ingresar la fecha del envío.";
    }elseif(input('destino')==""){   
        $this['error'] = "Debe indicar un destino del envío.";
    }else{
       $validator= true;
    }

    if ($validator) {
        Db::table('envios_locales')->where('id', $this->param('id'))->update(
            ['estado' => input('estado'),
            'fecha_envio' => input('fecha_envio_lc'),
            'destino' => input('destino'),
            'descripcion' => input('descripcion'),
            'prioridad' => input('prioridad'),
            'actualizado_por' => input('username')
            ]
        );  
        $this['mensaje_lc'] = "El envío fúe actualizado correctamente";
    }
}
?>
==

<div class="row">
	<div class="col-md-12">				
		<div class="panel panel-primary" id="form_locales"> 					
		    <div class="panel-heading"> 
		        <h3 class="panel-title">Editar envío local.</h3>
		    </div> 
		    <div class="panel-body">
		        <form data-request="onUpdate" data-request-update="envios_lc: '#result_envios'">		
		        <div class="col-md-12" style="display:none">
		        	<input type="text" name="username" id="username" value="{{ user.name }} {{ user.surname }}"/>
		        </div>			            		            
		            <div class="row">
		                <div class="col-md-3">
		                    <label for="estado">Estado:</label>
		                    <select id="estado" name="estado" class="form-control" >
		                    	<option value="Nueva" {% if local.estado == "Nueva" %}selected{% endif %}>Nueva</option>
		                    	<option value="Atendida" {% if local.estado == "Atendida" %}selected{% endif %}>Atendida</option>
		                    	<option value="Cancelada" {% if local.estado == "Cancelada" %}selected{% endif %}>Cancelada</option>
		                    	<option value="Pendiente" {% if local.estado == "Pendiente" %}selected{% endif %}>Pendiente</option>
		                    </select>
		                </div>
		                <div class="col-md-3">
		                    <label for="fecha_envio_lc">Fecha de envío:</label>
		                    <input type="text" id="fecha_envio_lc" name="fecha_envio_lc" class="form-control" value="{{ local.fecha_envio}}" required>
		                </div>
		                <div class="col-md-6">
		                    <label for="destino">destino:</label>
		                    <input type="text" id="destino" name="destino" class="form-control" value="{{ local.destino }}" required>
		                </div>
		                <div class="col-md-12">
		                    <label for="descripcion">descripcion:</label>
		                    <textarea id="descripcion" name="descripcion" class="form-control" required>{{ local.descripcion }}</textarea>
		                </div>        
		                <div class="col-md-4">
		                    <label for="prioridad">Prioridad:</label>
		                    <select id="prioridad" name="prioridad" class="form-control" >
		                    	<option value="Baja" {% if local.prioridad == "Baja" %}selected{% endif %}>Baja</option>
		                    	<option value="Normal" {% if local.prioridad == "Normal" %}selected{% endif %}>Normal</option>
		                    	<option value="Alta" {% if local.prioridad == "Alta" %}selected{% endif %}>Alta</option>
		                    	<option value="Urgente" {% if local.prioridad == "Urgente" %}selected{% endif %}>Urgente</option>
		                    </select>
		                </div>        				                
		            </div>   
		            <hr>
		            <div class="row">
		                <div id="result_envios" class="col-md-12">
		                    {% partial 'envios_lc' %}
		                </div>
		            </div>
		        </form>
		    </div>
		</div>
	</div>
</div>

<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<link rel="stylesheet" href="/resources/demos/style.css">
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<script>
$( function() {
$( "#fecha_envio_lc" ).datepicker({ dateFormat: 'yy-mm-dd' });
} );
</script>

